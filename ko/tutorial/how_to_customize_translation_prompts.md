# How to Customize OpenAI Translation Prompts

In version [3.7](#/updates/v3.7 ':ignore :target=_blank'), we introduced the ability to customize translation prompt templates for the OpenAI translation engine. This allows you to tailor your own translation prompts to better suit your translation needs. In this tutorial, you will learn how to customize translation prompts.

## Configuring Translation Prompt Template Files :id=template-file

Currently, we only support customizing translation prompt templates through configuration files. There are two template files for different types of translation:

- Regular Translation: `translator.prompt`
- Document Translation: `document.prompt`

The directory paths for the template files are:

- Windows: `%LOCALAPPDATA%\Yii.Guxing\TranslationPlugin\openai\`
- Other: `$XDG_DATA_HOME/Yii.Guxing/TranslationPlugin/openai/` or `~/.TranslationPlugin/openai/`

?> **Tip:** The prompt template files and directories are not automatically generated by default, so you may need to create them manually.

If you want to customize the translation prompts, you can create the corresponding prompt template files in the template directory and write your translation prompt templates in these files. Otherwise, the OpenAI translation engine will use the default translation prompt templates.

## Writing Translation Prompt Templates :id=write-template

The content format of the translation prompt template is as follows:

```plaintext
[ROLE1]
Message 1
[ROLE2]
Message 2
...
```

A template file must contain at least one **message template**, and a message template consists of two parts: **message role** and **message body**.

### Message Role :id=message-role

The message role is used to specify the role of the message and also serves as the identifier for the message template, distinguishing it from other message templates. The format of the message role is `[Role Name]`, where `Role Name` is the name of the message role. Currently, three roles are supported: `SYSTEM`, `USER`, and `ASSISTANT`. The first message in the template file can omit the message role definition. If the first message does not specify a role, it defaults to the `USER` role.

!> **Note:** The message role definition must occupy a single line, starting with `[` and ending with `]`. There should be no other characters, including whitespace, before `[` or after `]`.

### Message Body :id=message-body

Any content between two message role definitions or from a role definition to the end of the file (with no message role definitions in between) is considered part of the message body, including empty lines. Leading and trailing empty lines or whitespace in the message body will be ignored (empty lines or whitespace within the message body will be preserved). Additionally, common indentation across all lines of the message body will be ignored. Therefore, if your message body contains content that resembles a message role definition, you can add the same indentation to each line of the message body to avoid it being parsed as a message role definition:

```plaintext
[USER]
  Message line 1
  [SYSTEM]
  Message line 3
  ...
```

This will ultimately be rendered as:

- Message Role: USER
- Message Body:
  ```plaintext
  Message line 1
  [SYSTEM]
  Message line 3
  ...
  ```

### Template Engine :id=template-engine

The translation prompt templates are parsed and rendered using the [Apache Velocity](https://velocity.apache.org/engine/devel/user-guide.html) template engine. Therefore, you can write your templates using the Apache Velocity template language.

#### Template Variables :id=template-variables

| **Variable** | **Description** |
|:-------:|-----------|
| ${DS} | The symbol `$`, used to escape the `$` character |
| ${UTILS} | Utility object, which includes some useful utility functions. See [Utils](https://github.com/YiiGuxing/TranslationPlugin/blob/v3.7.0/src/main/kotlin/cn/yiiguxing/plugin/translate/trans/openai/prompt/template/Utils.kt) |
| ${LANGUAGE} | Language enumeration class, providing language enums and some utility functions. You can get the specified language enum object via `${LANGUAGE.LanguageName}` (e.g., `${LANGUAGE.CHINESE}`). See [LanguageEnum](https://github.com/YiiGuxing/TranslationPlugin/blob/v3.7.0/src/main/kotlin/cn/yiiguxing/plugin/translate/trans/openai/prompt/template/LanguageEnum.kt) and [Lang](https://github.com/YiiGuxing/TranslationPlugin/blob/v3.7.0/src/main/kotlin/cn/yiiguxing/plugin/translate/trans/Languages.kt#L28) |
| ${TEXT} | The text to be translated. For document translation, this will be HTML-formatted text |
| ${SOURCE_LANGUAGE} | The source language enum object of the text to be translated. See [Lang](https://github.com/YiiGuxing/TranslationPlugin/blob/v3.7.0/src/main/kotlin/cn/yiiguxing/plugin/translate/trans/Languages.kt#L28) (Note: It may be `AUTO`, so special handling is required) |
| ${TARGET_LANGUAGE} | The target language enum object for translation. See [Lang](https://github.com/YiiGuxing/TranslationPlugin/blob/v3.7.0/src/main/kotlin/cn/yiiguxing/plugin/translate/trans/Languages.kt#L28) |

### Default Prompt Templates :id=default-templates

translator.prompt

```plaintext
[SYSTEM]
You are a translator.
The user will provide you with text in triple quotes.
Translate the text#if($LANGUAGE.isExplicit($SOURCE_LANGUAGE)) from ${SOURCE_LANGUAGE.languageName} to#else into#end ${TARGET_LANGUAGE.languageName}.
Do not return the translated text in triple quotes.

[USER]
"""
$TEXT
"""
```

document.prompt

```plaintext
[SYSTEM]
You are a html document translator.
The user will provide you with an html document.
Translate the html document#if($LANGUAGE.isExplicit($SOURCE_LANGUAGE)) from ${SOURCE_LANGUAGE.languageName} to#else into#end ${TARGET_LANGUAGE.languageName}.
Do not translate the content inside "pre" and "code" tags.

[USER]
$TEXT
```